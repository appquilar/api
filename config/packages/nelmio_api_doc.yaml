nelmio_api_doc:
    html_config:
        assets_mode: 'offline'
    documentation:
        info:
            title: "Appquilar API"
            description: "API for Appquilar platform"
            version: "0.1.0"
        areas:
            exclude_path_patterns:
                - ^/_error
        paths:
            # Authentication
            /api/auth/register:
                post:
                    summary: "Register a new user"
                    tags:
                        - Authentication
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/RegisterUserDTO"
                    responses:
                        "201":
                            description: "User registered successfully"
                        "400":
                            description: "Validation error"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ValidationError"
            /api/auth/login:
                post:
                    summary: "Login a user"
                    tags: ["Authentication"]
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/LoginUserDTO"
                    responses:
                        "200":
                            description: "Successful login"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            token:
                                                type: string
                                                example: "eyJhbGciOiJIUzI1NiIsIn..."
                        "400":
                            description: "Invalid credentials"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            error:
                                                type: string
                                                example: "Invalid credentials"
            /api/auth/logout:
                post:
                    summary: "Logout a user"
                    description: "Revokes the user's access token, effectively logging them out."
                    tags:
                        - Authentication
                    security:
                        - BearerAuth: [ ]
                    responses:
                        "200":
                            description: "Logout successful"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            success:
                                                type: boolean
                                                example: "true"
                        "401":
                            description: "Unauthorized - Missing or invalid token"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            error:
                                                type: string
                                                example: "Invalid token"

            /api/auth/forgot-password:
                post:
                    summary: "Request a password reset link"
                    tags: ["Authentication"]
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    type: object
                                    required: ["email"]
                                    properties:
                                        email:
                                            type: string
                                            example: "user@example.com"
                    responses:
                        "200":
                            description: "Forgot password email sent successfully"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            message:
                                                type: string
                                                example: "Forgot password email sent successfully"
                        "400":
                            description: "Validation error"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ValidationError"
            /api/auth/change-password:
                post:
                    summary: "Change password using the forgot password token"
                    tags: ["Authentication"]
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        email:
                                            type: string
                                            example: "user@example.com"
                                        token:
                                            type: string
                                            format: uuid
                                            example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                                        password:
                                            type: string
                                            example: "NewSecurePass123"
                    responses:
                        204:
                            description: "Password changed successfully"
                        400:
                            description: "Validation error"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ValidationError"
                        401:
                            description: "Invalid or expired token"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            success:
                                                type: boolean
                                                example: false
                                            errors:
                                                type: object
                                                example: "Invalid or expired token"
            # User
            /api/me:
                get:
                    summary: "Get the authenticated user's details"
                    description: "Fetch the details of the currently authenticated user"
                    tags:
                        - "User"
                    security:
                        - bearerAuth: [ ]
                    responses:
                        "200":
                            description: "User details retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/User"
                        "401":
                            description: "Unauthorized - User not authenticated"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            error:
                                                type: string
                                                example: "Unauthorized"
            /api/users/{user_id}:
                get:
                    summary: "Get the specific user's details"
                    description: "Fetch the details of an user by its ID"
                    tags:
                        - "User"
                    parameters:
                        - in: path
                          name: user_id
                          schema:
                              type: uuid
                          required: true
                          description: UUID of the user to get
                    responses:
                        "200":
                            description: "User details retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/User"
                patch:
                    summary: "Update user details"
                    description: "Allows an admin or the user themselves to update user details (name, roles, etc.)."
                    tags:
                        - "User"
                    parameters:
                        - name: "user_id"
                          in: "path"
                          required: true
                          schema:
                              type: "string"
                          example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                    security:
                        - BearerAuth: [ ]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/UpdateUserDTO"
                    responses:
                        "204":
                            description: "User updated successfully"
                        "401":
                            description: "Unauthorized"
                        "404":
                            description: "User not found"

            /api/users/{user_id}/address:
                patch:
                    summary: "Update user address and geolocation"
                    description: "Updates the user address and geolocation"
                    tags:
                        - "User"
                    parameters:
                        - name: "user_id"
                          in: "path"
                          required: true
                          schema:
                              type: "string"
                          example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                    security:
                        - BearerAuth: [ ]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        address:
                                            $ref: "#/components/schemas/Address"
                                        location:
                                            $ref: "#/components/schemas/Location"
                    responses:
                        "204":
                            description: "User updated successfully"
                        "401":
                            description: "Unauthorized"
                        "404":
                            description: "Bad request"

            /api/users/{user_id}/change-password:
                patch:
                    summary: "Change the user's password"
                    description: "Allows an authenticated user to update their password."
                    tags:
                        - "User"
                    parameters:
                        - name: "user_id"
                          in: "path"
                          required: true
                          schema:
                              type: "string"
                          example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                    security:
                        - bearerAuth: []
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/UpdateUserPasswordDTO"
                    responses:
                        "204":
                            description: "Password changed successfully"
                        "401":
                            description: "Unauthorized - Invalid credentials or not authenticated"

            /api/companies:
                post:
                    tags:
                        - Company
                    summary: "Create a new company"
                    description: "Creates a new company and assigns an owner."
                    security:
                        - bearerAuth: []
                    operationId: createCompany
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/CreateCompanyDto"
                    responses:
                        "201":
                            description: "Company successfully created"
                        "400":
                            description: "Validation error"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ValidationError"
                        "401":
                            description: "Unauthorized - User not authenticated"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            error:
                                                type: string
                                                example: "Unauthorized"
            /api/companies/{slug}:
                get:
                    summary: "Get details of a company by its slug"
                    tags:
                        - Company
                    parameters:
                        - in: path
                          name: slug
                          required: true
                          schema:
                              type: string
                              example: "acme-inc"
                    responses:
                        200:
                            description: "Company details retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/Company"
                        404:
                            description: "Company not found"

            /api/companies/{company_id}:
                get:
                    summary: "Get details of a company by its id"
                    tags:
                        - Company
                    parameters:
                        - in: path
                          name: companyId
                          required: true
                          schema:
                              type: string
                              format: uuid
                    responses:
                        200:
                            description: "Company details retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/Company"
                        404:
                            description: "Company not found"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            error:
                                                type: string
                                                example: "Company with id xxxx-xxx-xxx-xx-xxxx not found"
                patch:
                    summary: "Update a company"
                    tags:
                        - Company
                    parameters:
                        - in: path
                          name: companyId
                          required: true
                          schema:
                              type: string
                              format: uuid
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/UpdateCompanyDto"
                    responses:
                        204:
                            description: "Company updated successfully"
                        400:
                            description: "Error on validation"
                        401:
                            description: "You only can update a company if you're an admin of the platform or a company's admin. So not enough scopes granted."
            /api/companies/{company_id}/users:
                get:
                    summary: "Get paginated list of users for a company"
                    description: "Retrieves a paginated list of users associated with a company. Only accessible by company admins or platform administrators."
                    tags:
                        - Company
                    parameters:
                        - name: company_id
                          in: path
                          required: true
                          description: "The UUID of the company"
                          schema:
                              type: string
                              format: uuid
                        - name: page
                          in: query
                          required: false
                          description: "The page number (default: 1)"
                          schema:
                              type: integer
                              default: 1
                        - name: per_page
                          in: query
                          required: false
                          description: "Number of users per page (default: 10, max: 50)"
                          schema:
                              type: integer
                              default: 10
                              maximum: 50
                    security:
                        - bearerAuth: [ ]
                    responses:
                        "200":
                            description: "Successful response with paginated company users"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/CompanyUser"
                                            total:
                                                type: integer
                                                description: "Total number of users"
                                                example: 3
                                            page:
                                                type: integer
                                                description: "Current page number"
                                                example: 1
                        "401":
                            description: "Unauthorized - User is not logged in"
                        "404":
                            description: "Company not found"
                post:
                    summary: "Invite a User to a Company"
                    description: >
                        Assign an existing user to a company or send an invitation to a new user.
                        Only a company admin or platform admin can perform this action.
                    operationId: addUserToCompany
                    tags:
                        - Company
                    security:
                        - BearerAuth: [ ]
                    parameters:
                        - name: company_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "The ID of the company where the user will be added."
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        userId:
                                            type: string
                                            format: uuid
                                            nullable: true
                                            description: "The existing user's ID (if assigning an existing user). If null, an invitation will be sent."
                                        email:
                                            type: string
                                            format: email
                                            example: "user@example.com"
                                            description: "The email of the user (required for both existing and new users)."
                                        role:
                                            type: string
                                            enum: [ ADMIN, CONTRIBUTOR ]
                                            example: "CONTRIBUTOR"
                                            description: "The role assigned to the user within the company."
                                    required:
                                        - email
                                        - role
                    responses:
                        "201":
                            description: "User successfully added to the company (or invited)."
                        "400":
                            description: "Invalid request. Possible reasons: malformed UUID, missing required fields, or the user already belongs to another company."
                        "401":
                            description: "Unauthorized - Only a company admin or platform admin can perform this action."

                        "404":
                            description: "Company not found."
            /api/companies/{company_id}/users/{user_id}:
                patch:
                    tags:
                        - Company
                    summary: "Update a user's role in a company"
                    description: "Allows admins to change the role of a user in a company."
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - in: path
                          name: company_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the company."
                        - in: path
                          name: user_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the user."
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        role:
                                            type: string
                                            enum: [ ADMIN, CONTRIBUTOR ]
                                            example: "ADMIN"
                    responses:
                        "204":
                            description: "User role updated successfully."
                        "401":
                            description: "Unauthorized - User lacks necessary permissions."
                        "404":
                            description: "User not found in the company."
                delete:
                    summary: Remove a user from a company
                    tags:
                        - Company
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - name: company_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                        - name: user_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                    responses:
                        "204":
                            description: User removed from company successfully.
                        "400":
                            description: You can't remove yourself.
                        "401":
                            description: Unauthorized to perform this action.
                        "404":
                            description: User is not part of this company

            /api/companies/{company_id}/invitations/{token}/accept:
                post:
                    summary: Accept an invitation to join a company
                    description: If the user does not exist, they are created. Otherwise, they are linked to the company.
                    tags:
                        - Company
                    parameters:
                        - name: company_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: The ID of the company
                        - name: token
                          in: path
                          required: true
                          schema:
                              type: string
                          description: The invitation token
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        email:
                                            type: string
                                            format: email
                                        password:
                                            type: string
                                            format: password
                    responses:
                        "204":
                            description: Invitation accepted successfully.
                        "400":
                            description: Invalid token, expired invitation, or user already exists.
                        "401":
                            description: Unauthorized access.
            /api/media/images/upload:
                post:
                    tags:
                        - Media
                    summary: "Upload an image"
                    description: "Uploads an image file to the storage system."
                    security:
                        - bearerAuth: [ ]
                    requestBody:
                        required: true
                        content:
                            multipart/form-data:
                                schema:
                                    type: object
                                    properties:
                                        file:
                                            type: string
                                            format: binary
                                            description: "The image file to upload"
                    responses:
                        "201":
                            description: "Image uploaded successfully"
                        "400":
                            description: "Invalid file type or missing file"
                        "500":
                            description: "Unexpected server error"

            /api/media/images/{image_id}/{size}:
                get:
                    tags:
                        - Media
                    summary: "Retrieve an image with specified size"
                    description: "Fetches an image by its ID and resizes it to the requested size."
                    parameters:
                        - name: image_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "Unique identifier of the image"
                        - name: size
                          in: path
                          required: true
                          schema:
                            $ref: "#/components/schemas/ImageSize"
                          description: "Desired image size"
                    responses:
                        "200":
                            description: "Returns the requested image"
                            content:
                                image/jpeg: { }
                                image/png: { }
                        "404":
                            description: "Image not found"
                        "400":
                            description: "Invalid size parameter"

            /api/media/images/{image_id}:
                delete:
                    tags:
                        - Media
                    summary: "Delete an image"
                    description: "Deletes an image from storage by its ID."
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - name: image_id
                          in: path
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "Unique identifier of the image"
                    responses:
                        "204":
                            description: "Image deleted successfully"
                        "404":
                            description: "Image not found"
                        "403":
                            description: "Unauthorized access to delete"
            /api/categories:
                post:
                    tags:
                        - Category
                    summary: "Create a new category"
                    description: "Creates a new category in the system"
                    security:
                        - bearerAuth: [ ]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/Category"
                    responses:
                        201:
                            description: "Category successfully created"
                        400:
                            description: "Validation failed"
                        401:
                            description: "Not enough scopes granted"
            /api/categories/{category_id}:
                patch:
                    tags:
                        - Category
                    summary: "Update a category"
                    description: "Updates a category in the system"
                    security:
                        - bearerAuth: [admin]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/CategoryResponse"
                    responses:
                        204:
                            description: "Category successfully updated"
                        400:
                            description: "Validation failed"
                        401:
                            description: "Not enough scopes granted"
                get:
                    tags:
                        - Category
                    summary: "Get a category by its id"
                    description: "Get a category by its id"
                    parameters:
                        - in: path
                          name: category_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                    responses:
                        200:
                            description: "Category successfully retrieved"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/CategoryResponse"
                        400:
                            description: "Validation failed"
            /api/categories/{slug}:
                get:
                    tags:
                        - Category
                    summary: "Get a category by its slug"
                    description: "Get a category by its slug"
                    parameters:
                        - in: path
                          name: slug
                          required: true
                          schema:
                              type: string
                              example: 'tools-and-machinery'
                    responses:
                        200:
                            description: "Category successfully retrieved"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/CategoryResponse"
                        400:
                            description: "Validation failed"
            /api/categories/{category_id}/breadcrumbs:
                get:
                    tags:
                        - Category
                    summary: "Get the list of breadcrumbs for a category"
                    description: "Get the list of breadcrumbs for a category"
                    parameters:
                        - in: path
                          name: slug
                          required: true
                          schema:
                              type: string
                              example: 'tools-and-machinery'
                    responses:
                        200:
                            description: "List of breadcrumbs correctly retrieved"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/CategoryBreadcrumbsResponse"

            /api/sites:
                post:
                    tags:
                        - Sites
                    summary: "Create a new site"
                    description: "Creates a new site in the system"
                    security:
                        - bearerAuth: [ admin ]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/Site"
                    responses:
                        201:
                            description: "Category successfully retrieved"
                        400:
                            description: "Validation failed"
                get:
                    tags:
                        - Sites
                    summary: "Get all sites"
                    description: "Get all sites"
                    responses:
                        200:
                            description: "Category successfully retrieved"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/Site"
            /api/sites/{site_id}:
                patch:
                    tags:
                        - Sites
                    summary: "Updates a new site"
                    description: "Updates a new site in the system"
                    security:
                        - bearerAuth: [ admin ]
                    requestBody:
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/Site"
                    responses:
                        204:
                            description: "Category successfully updated"
                        400:
                            description: "Validation failed"
                get:
                    tags:
                        - Sites
                    summary: "Get a site by its id"
                    description: "Get a site by its id"
                    parameters:
                        - in: path
                          name: site_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                    responses:
                        200:
                            description: "Category successfully retrieved"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/Site"
                        400:
                            description: "Validation failed"

            /api/products:
                post:
                    tags:
                        - Product
                    summary: "Create a new product"
                    description: "Creates a new product with basic information"
                    security:
                        - bearerAuth: [ ]
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/CreateProductDto"
                    responses:
                        "201":
                            description: "Product successfully created"
                        "400":
                            description: "Validation error"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ValidationError"
                        "401":
                            description: "Unauthorized - User not authenticated"
            /api/products/{slug}:
                get:
                    tags:
                        - Product
                    summary: "Get product by slug"
                    description: "Retrieves detailed information for a specific product by its slug"
                    parameters:
                        - in: path
                          name: slug
                          required: true
                          schema:
                              type: string
                          description: "Slug of the product to retrieve"
                    responses:
                        "200":
                            description: "Product retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ProductResponse"
                        "404":
                            description: "Product not found"

            /api/companies/{owner_id}/products:
                get:
                    tags:
                        - Product
                    summary: "Get products by company"
                    description: "Retrieves a paginated list of products for a specific company"
                    parameters:
                        - in: path
                          name: company_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the company"
                        - in: query
                          name: page
                          required: false
                          schema:
                              type: integer
                              default: 1
                          description: "Page number for pagination"
                        - in: query
                          name: per_page
                          required: false
                          schema:
                              type: integer
                              default: 10
                              maximum: 50
                          description: "Items per page"
                    responses:
                        "200":
                            description: "Products retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/ProductResponse"
                                            total:
                                                type: integer
                                                description: "Total number of products"
                                            page:
                                                type: integer
                                                description: "Current page number"
            /api/categories/{category_id}/products:
                get:
                    tags:
                        - Product
                    summary: "Get products by a category"
                    description: "Retrieves a paginated list of products for a specific category and its parents"
                    parameters:
                        - in: path
                          name: category_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the category from where we pivot"
                        - in: query
                          name: page
                          required: false
                          schema:
                              type: integer
                              default: 1
                          description: "Page number for pagination"
                        - in: query
                          name: per_page
                          required: false
                          schema:
                              type: integer
                              default: 10
                              maximum: 50
                          description: "Items per page"
                    responses:
                        "200":
                            description: "Products retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/ProductResponse"
                                            total:
                                                type: integer
                                                description: "Total number of products"
                                            page:
                                                type: integer
                                                description: "Current page number"

            /api/users/{owner_id}/products:
                get:
                    tags:
                        - Product
                    summary: "Get products by user"
                    description: "Retrieves a paginated list of products for a specific user"
                    parameters:
                        - in: path
                          name: user_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the company"
                        - in: query
                          name: page
                          required: false
                          schema:
                              type: integer
                              default: 1
                          description: "Page number for pagination"
                        - in: query
                          name: per_page
                          required: false
                          schema:
                              type: integer
                              default: 10
                              maximum: 50
                          description: "Items per page"
                    responses:
                        "200":
                            description: "Products retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        type: object
                                        properties:
                                            data:
                                                type: array
                                                items:
                                                    $ref: "#/components/schemas/ProductResponse"
                                            total:
                                                type: integer
                                                description: "Total number of products"
                                            page:
                                                type: integer
                                                description: "Current page number"

            /api/products/{product_id}:
                get:
                    tags:
                        - Product
                    summary: "Get product by ID"
                    description: "Retrieves detailed information for a specific product"
                    parameters:
                        - in: path
                          name: product_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the product to retrieve"
                    responses:
                        "200":
                            description: "Product retrieved successfully"
                            content:
                                application/json:
                                    schema:
                                        $ref: "#/components/schemas/ProductResponse"
                        "404":
                            description: "Product not found"

                patch:
                    tags:
                        - Product
                    summary: "Update product basic information"
                    description: "Updates the basic information of an existing product"
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - in: path
                          name: product_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the product to update"
                    requestBody:
                        required: true
                        content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/UpdateProductDto"
                    responses:
                        "204":
                            description: "Product updated successfully"
                        "400":
                            description: "Validation error"
                        "401":
                            description: "Unauthorized - User not authenticated"
                        "404":
                            description: "Product not found"

            /api/products/{product_id}/publish:
                patch:
                    tags:
                        - Product
                    summary: "Publish a product"
                    description: "Changes a product's publication status to published"
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - in: path
                          name: product_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the product"
                    responses:
                        "204":
                            description: "Product published successfully"
                        "401":
                            description: "Unauthorized - User not authenticated"
                        "404":
                            description: "Product not found"

            /api/products/{product_id}/unpublish:
                patch:
                    tags:
                        - Product
                    summary: "Unpublish a product"
                    description: "Changes a product's publication status to draft"
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - in: path
                          name: product_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the product"
                    responses:
                        "204":
                            description: "Product unpublished successfully"
                        "401":
                            description: "Unauthorized - User not authenticated"
                        "404":
                            description: "Product not found"

            /api/products/{product_id}/archive:
                patch:
                    tags:
                        - Product
                    summary: "Archive a product"
                    description: "Changes a product's publication status to archived"
                    security:
                        - bearerAuth: [ ]
                    parameters:
                        - in: path
                          name: product_id
                          required: true
                          schema:
                              type: string
                              format: uuid
                          description: "UUID of the product"
                    responses:
                        "204":
                            description: "Product archived successfully"
                        "401":
                            description: "Unauthorized - User not authenticated"
                        "404":
                            description: "Product not found"


        components:
            schemas:
                RegisterUserDTO:
                    type: object
                    required:
                        - user_id
                        - email
                        - password
                    properties:
                        user_id:
                            type: string
                            format: uuid
                            example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                        email:
                            type: string
                            example: "testuser@example.com"
                        password:
                            type: string
                            example: "SecurePass123"
                LoginUserDTO:
                    type: object
                    required: ["email", "password"]
                    properties:
                        email:
                            type: string
                            example: "user@example.com"
                        password:
                            type: string
                            example: "SecurePass123"
                UpdateUserDTO:
                    type: "object"
                    properties:
                        first_name:
                            type: "string"
                            example: "John"
                        last_name:
                            type: "string"
                            example: "Doe"
                        roles:
                            type: array
                            items:
                                $ref: "#/components/schemas/UserRoles"
                UpdateUserPasswordDTO:
                    type: object
                    required: ["old_password", "new_password"]
                    properties:
                        old_password:
                            type: string
                            example: "OldPassword123"
                        new_password:
                            type: string
                            example: "NewSecurePassword456"
                UserRoles:
                    type: string
                    enum:
                        - ROLE_USER
                        - ROLE_ADMIN
                User:
                    type: object
                    properties:
                        id:
                            type: string
                            format: uuid
                            example: "cdd52b98-9183-41b9-8e27-4d12c5ddcf3c"
                        first_name:
                            type: string
                            example: "John"
                        last_name:
                            type: string
                            example: "Doe"
                        email:
                            type: string
                            format: email
                            example: "testuser@example.com"
                        roles:
                            type: array
                            items:
                                $ref: "#/components/schemas/UserRoles"
                        address:
                            $ref: "#/components/schemas/Address"
                        location:
                            $ref: "#/components/schemas/Location"

                Company:
                    type: object
                    properties:
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Acme Inc."
                        slug:
                            type: string
                            example: "acme-inc"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        fiscal_identifier:
                            type: string
                            description: "In Spain, the CIF"
                            example: "123456789"
                        contact_email:
                            type: string
                            format: email
                            example: "contact@acme.com"
                        phone_number:
                            $ref: "#/components/schemas/PhoneNumber"
                        address:
                            $ref: "#/components/schemas/Address"
                        location:
                            $ref: "#/components/schemas/Location"

                CompanyUser:
                    type: object
                    properties:
                        user_id:
                            type: string
                            format: uuid
                            nullable: true
                            description: "UUID of the user"
                        email:
                            type: string
                            format: email
                            description: "User's email address"
                        role:
                            type: string
                            enum: [ ADMIN, CONTRIBUTOR ]
                            description: "Role of the user in the company"
                        status:
                            type: string
                            enum: [ ACCEPTED, PENDING, EXPIRED ]
                            description: "Status of the user's invitation"
                UpdateCompanyDto:
                    type: object
                    properties:
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Acme Inc."
                        slug:
                            type: string
                            example: "acme-inc"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        fiscal_identifier:
                            type: string
                            description: "In Spain, the CIF"
                            example: "123456789"
                        address:
                            type: string
                            example: "1234 Elm Street, Springfield"
                        postal_code:
                            type: string
                            example: "12345"
                        city:
                            type: string
                            example: "Springfield"
                        contact_email:
                            type: string
                            format: email
                            example: "contact@acme.com"
                        phone_number_country_code:
                            type: string
                            example: "ES"
                        phone_number_prefix:
                            type: string
                            example: "+34"
                        phone_number_number:
                            type: string
                            example: "666000000"
                PhoneNumber:
                    type: object
                    properties:
                        prefix:
                            type: string
                            example: "+34"
                        country_code:
                            type: string
                            example: "ES"
                        number:
                            type: string
                            example: "666000000"
                ValidationError:
                    type: object
                    properties:
                        success:
                            type: boolean
                            example: false
                        error:
                            type: object
                            properties:
                                errors:
                                    type: array
                                    items:
                                        type: array
                                        items:
                                            field:
                                                type: string
                                                example: "auth.register.user_id.not_blank"
                CreateCompanyDto:
                    type: object
                    properties:
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Acme Inc."
                        owner_id:
                            type: string
                            format: uuid
                            example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        fiscal_identifier:
                            type: string
                            description: "In Spain, the CIF"
                            example: "123456789"
                        address:
                            type: string
                            example: "1234 Elm Street, Springfield"
                        postal_code:
                            type: string
                            example: "12345"
                        city:
                            type: string
                            example: "Springfield"
                        contact_email:
                            type: string
                            format: email
                            example: "contact@acme.com"
                        phone_number_country_code:
                            type: string
                            example: "ES"
                        phone_number_prefix:
                            type: string
                            example: "+34"
                        phone_number_number:
                            type: string
                            example: "666000000"
                ImageSize:
                    type: string
                    enum: [ ORIGINAL, LARGE, MEDIUM, THUMBNAIL ]
                    description: "Size of the image"

                Category:
                    type: object
                    properties:
                        category_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Tools and machinery"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        parent_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        icon_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        featured_image_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        landscape_image_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"

                CategoryResponse:
                    type: object
                    properties:
                        category_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Tools and machinery"
                        slug:
                            type: string
                            example: "tools-and-machinery"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        parent_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        icon_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        featured_image_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        landscape_image_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                CategoryBreadcrumbsResponse:
                    type: object
                    properties:
                        id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        parent_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Tools and machinery"
                        slug:
                            type: string
                            example: "tools-and-machinery"
                        icon_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        depth:
                            type: integer
                            example: 3
                Site:
                    type: object
                    properties:
                        site_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Acme Inc."
                        title:
                            type: string
                            example: "Acme|Appquilar"
                        url:
                            type: string
                            example: "https://acme-inc.com"
                        description:
                            type: string
                            example: "Leading provider of innovative solutions"
                        logo_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        favicon_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        primary_color:
                            type: string
                            description: "The primary color of the site in hex"
                            example: "FF0000"
                        category_ids:
                            $ref: "#/components/schemas/UuidArray"
                        menu_category_ids:
                            $ref: "#/components/schemas/UuidArray"
                        featured_category_ids:
                            $ref: "#/components/schemas/UuidArray"
                UuidArray:
                    type: array
                    items:
                        type: string
                        format: uuid
                Money:
                    type: object
                    properties:
                        amount:
                            type: number
                            format: float
                            example: 29.99
                        currency:
                            type: string
                            example: "EUR"
                            description: "3-letter ISO currency code"

                PublicationStatus:
                    type: object
                    properties:
                        status:
                            type: string
                            enum: [ draft, published, archived ]
                            example: "published"
                        published_at:
                            type: string
                            format: date-time
                            nullable: true
                            example: "2025-01-15T14:30:00Z"

                CreateProductDto:
                    type: object
                    required:
                        - product_id
                        - name
                        - internal_id
                        - company_id
                        - tiers
                        - deposit
                    properties:
                        product_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Sierra de Mesa con Soporte"
                        internal_id:
                            type: string
                            example: "PRD002"
                        description:
                            type: string
                            example: "Sierra de mesa porttil con soporte plegable. Ideal para obras y proyectos DIY."
                        quantity:
                            type: integer
                            example: 1
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        category_id:
                            type: string
                            format: uuid
                            nullable: true
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        image_ids:
                            type: array
                            items:
                                type: string
                                format: uuid
                            example: [ "550e8400-e29b-41d4-a716-446655440000", "550e8400-e29b-41d4-a716-446655440001" ]
                        deposit:
                            $ref: "#/components/schemas/Money"
                        tiers:
                            $ref: "#/components/schemas/TierCollection"

                UpdateProductDto:
                    type: object
                    required:
                        - product_id
                        - name
                        - slug
                        - internal_id
                        - company_id
                        - tiers
                        - deposit
                    properties:
                        product_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Sierra de Mesa con Soporte"
                        slug:
                            type: string
                            example: "sierra-de-mesa-con-soporte"
                        internal_id:
                            type: string
                            example: "PRD002"
                        description:
                            type: string
                            example: "Sierra de mesa porttil con soporte plegable. Ideal para obras y proyectos DIY."
                        quantity:
                            type: integer
                            example: 1
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        category_id:
                            type: string
                            format: uuid
                            nullable: true
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        image_ids:
                            type: array
                            items:
                                type: string
                                format: uuid
                            example: [ "550e8400-e29b-41d4-a716-446655440000", "550e8400-e29b-41d4-a716-446655440001" ]
                        deposit:
                            $ref: "#/components/schemas/Money"
                        tiers:
                            $ref: "#/components/schemas/TierCollection"

                ProductResponse:
                    type: object
                    properties:
                        id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        name:
                            type: string
                            example: "Sierra de Mesa con Soporte"
                        slug:
                            type: string
                            example: "sierra-de-mesa-con-soporte"
                        internal_id:
                            type: string
                            example: "PRD002"
                        description:
                            type: string
                            example: "Sierra de mesa porttil con soporte plegable. Ideal para obras y proyectos DIY."
                        company_id:
                            type: string
                            format: uuid
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        category_id:
                            type: string
                            format: uuid
                            nullable: true
                            example: "550e8400-e29b-41d4-a716-446655440000"
                        image_ids:
                            type: array
                            items:
                                type: string
                                format: uuid
                            example: [ "550e8400-e29b-41d4-a716-446655440000", "550e8400-e29b-41d4-a716-446655440001" ]
                        publication_status:
                            $ref: "#/components/schemas/PublicationStatus"
                        deposit:
                            $ref: "#/components/schemas/Money"
                        tiers:
                            $ref: "#/components/schemas/TierCollection"

                Tier:
                    type: object
                    properties:
                        price_per_day:
                            $ref: "#/components/schemas/Money"
                        days_from:
                            type: integer
                            example: 1
                        days_to:
                            type: integer
                            example: 2

                TierCollection:
                    type: array
                    items:
                        $ref: "#/components/schemas/Tier"

                Address:
                    type: object
                    properties:
                        street:
                            type: string
                            example: "Fake street"
                        street2:
                            type: string
                            example: "number 123"
                        city:
                            type: string
                            example: "Springfield"
                        postal_code:
                            type: string
                            example: "CP1234"
                        state:
                            type: string
                            example: "Illinois"
                        country:
                            type: string
                            example: "Spain"

                Location:
                    type: object
                    properties:
                        latitude:
                            type: float
                            example: 1.01101010
                        longitude:
                            type: float
                            example: -2.0123123
